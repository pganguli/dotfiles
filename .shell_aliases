# use vim as default editor
export EDITOR=nvim
export VISUAL=nvim-qt

# tell gpg-agent to use pinentry on current tty
unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
  export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi
export GPG_TTY=$(tty)
gpg-connect-agent updatestartuptty /bye >/dev/null

# use vim as a pager; strip ANSI escape codes and pipe to vim's less macro
export PAGER="sh -c \"perl -pe 's/\e\[[0-9;]*[a-zA-Z]//g' | nvim -c 'set nolist nomodified' -\""
export MANPAGER="nvim -c Man!"

alias zoom="firejail zoom"
alias element="dbus-run-session flatpak run im.riot.Riot"
alias xc="xclip -selection clipboard"
alias lv="$PAGER"
alias nv="nvim"
alias nvq="nvim-qt"

cz() {
    cd "$(fzf)"
}

nz() {
    nvim "$(fzf)"
}

cpr() {
    rsync --archive --human-readable --human-readable --partial --info=stats1 --info=progress2 --modify-window=1 "$@"
}

startw() {
    for VAR in $(cat ~/.config/sway/env); do
        export "$VAR"
    done
    exec systemd-cat --identifier=sway sway
}

wlrec() {
    wf-recorder -c libx264rgb -p crf=27 -p preset=ultrafast \
                -f "$(date +%Y-%m-%d_%H.%M.%S).mkv"
}

x11rec() {
    ffmpeg -f x11grab -video_size 1920x1080 -framerate 30 -i :0.0 \
           -f pulse -ac 2 -i 0 \
           -codec:a libopus -application voip \
           -codec:v libx264rgb -crf 27 -preset ultrafast \
           "$(date +%Y-%m-%d_%H.%M.%S).mkv"
}

pulserec() {
    ffmpeg -f pulse -ac 2 -i 0 \
           -codec:a libopus -application voip \
           "$(date +%Y-%m-%d_%H.%M.%S).opus"
}

ffmpeg-concat() {
    echo > ffmpeg-concat.tmp
    for i in "$@"; do
        echo "file '$i'" >> ffmpeg-concat.tmp
    done

    ffmpeg -f concat -safe 0 -i ffmpeg-concat.tmp -c copy "$(date +%Y-%m-%d_%H.%M.%S).mkv"
    rm ffmpeg-concat.tmp
}

gpg-enc() {
    gpg --symmetric --s2k-cipher-algo AES256 --s2k-digest-algo SHA512 --s2k-count 65536 "$1"
}

gpg-dec() {
    gpg --output "${1%.gpg}" --decrypt "$1"
}

gpg-export-keys() {
    cat <(gpg --output - --export "$1") <(gpg --output - --export-secret-key "$1") |\
    gpg --armor --output keys.asc --symmetric --cipher-algo AES256
}

dirminus() {
    jdupes -ZrdNO $1 $2
}

ncmuck() {
    trap "rm ncmuck_stdin 2> /dev/null" INT
    mkfifo ncmuck_stdin 2> /dev/null
    tail -f ncmuck_stdin | nc --ssl "$1" "$2" -o "/tmp/ncmuck-$(date +%Y-%m-%d_%H.%M.%S).tmp"
}
