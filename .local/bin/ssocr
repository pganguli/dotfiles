#!/bin/sh

getTargetDirectory() {
  test -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" && \
    . "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"

  echo "${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME}}"
}

OUTPUTBASE="$(getTargetDirectory)/$(date --iso-8601=ns)"
grimshot save area '-' | mogrify -resize 400% 'PNG:-' | tesseract '-' "$OUTPUTBASE" txt quiet
wl-copy < "${OUTPUTBASE}.txt"
